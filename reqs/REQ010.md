# REQ010: Message File 

用于记录对话历史，默认扩展名为 .msg.md

## 标准格式

参考 REQ7

## 说明

1. Message File 可以从文件中加载 msg.md ， 考虑到文件可能为空，因此并不总是和 agent 关联。

2. Message File 可以支持关联多个 agent。 

3. 对于系统预制的 agent， 记录在文件的 meta | frontmatter

4. 对于基于模型名称临时构造的 agent, 记录在文件正文。

    - 很难通过名称指定 agent（虽然有名字，但是可以认为是匿名的） 
    - 如后续追加了 agent ，则后续的推理，默认使用 agent 列表中的第一个 agent。 
    - 可以通过 set default 调整排序
    - 可以通过 list chat_file/agent 列出 当前对话记录中涉及的 agent

4. 可以通过 list chat_file/item 或 可以通过 list chat_file 列出已经存在的消息记录

## 接口


- add_agent(agent_name)
- add_agent_with_definition(agent_name, definition)
- set_default_agent(agent_name)
- list_agents()  # 没有 remove agent 的需求, 需要直接修改文件
- add_mesage(prompt, name=None, timeout=None)  # 如果 agent_name 为空，则使用默认 agent
    - 如果 name 为空，则自动生成(顺序编号)
    - 不需要在 message 中记录 agent_name
- add_function_call(message_name, function_name, args=None, timeout=None)
    - function_name 可以是 function 的名称，也可以是 agent 的名称
    - agent 也可以定义 function ( 类似 mcp 的 prompt )
    - timeout 仅记录，当实际执行|执行推理时，才生效
- add_output(message_name, output, agent_name=None, nonce=None)  # 如果 agent_name 为空，则使用默认 agent
    - output 是个对象，默认为 text ，但是携带 mime_type, 不排除后续支持其他类型
    - 也可以考虑 增加 mime_type 参数， output 如果是 二进制则为 BASE64
    - nonce 用于标识输出的唯一性，
- add_output_placeholder(message_name, placeholder_name, nonce=None)
    - 用于异步调用，placeholder_name 为存储实际推理结果的文件名
    - nonce 用于标识输出的唯一性

- add_tool_with_definition(tool_name, definition)
    - definition 是一个 message 的数组，用于交互的使用 python 定义工具。

    

